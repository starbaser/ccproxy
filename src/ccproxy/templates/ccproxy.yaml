ccproxy:
  debug: true
  handler: "ccproxy.handler:CCProxyHandler"

  # OAuth token refresh settings
  oauth_ttl: 28800  # Token lifetime in seconds (default: 8 hours)
  oauth_refresh_buffer: 0.1  # Refresh at 90% of TTL (10% buffer)

  # OAuth token sources - shell commands to retrieve tokens for each provider
  oat_sources:
    # Simple string form (provider name used for detection)
    anthropic: "jq -r '.claudeAiOauth.accessToken' ~/.claude/.credentials.json"

    # Extended form with destinations (auto-inject token for matching api_base URLs)
    # zai:
    #   command: "jq -r '.accessToken' ~/.zai/credentials.json"
    #   user_agent: "MyApp/1.0.0"
    #   destinations:
    #     - "api.z.ai"           # Matches https://api.z.ai/api/anthropic
    #     - "z.ai"               # Matches any z.ai subdomain

    # Extended form with custom User-Agent only
    # gemini:
    #   command: "jq -r '.access_token' ~/.gemini/oauth_creds.json"
    #   user_agent: "MyApp/1.0.0"

  hooks:
    - ccproxy.hooks.rule_evaluator # evaluates rules against request
    - ccproxy.hooks.model_router # routes to appropriate model (coupled with rule_evaluator)
    - ccproxy.hooks.capture_headers # captures all HTTP headers with sensitive value redaction
    # Hook with params example - capture only specific headers:
    # - hook: ccproxy.hooks.capture_headers
    #   params:
    #     headers: [user-agent, x-request-id, content-type]
    - ccproxy.hooks.forward_oauth # forwards oauth token to provider (place after routing logic)
    - ccproxy.hooks.add_beta_headers # adds anthropic-beta headers for Claude Code OAuth
    - ccproxy.hooks.inject_claude_code_identity # injects required system message for OAuth
    # - ccproxy.hooks.forward_apikey # forwards x-api-key header from request (enable if needed)

  # uses the original model that Claude Code requested when no routing rule matches.
  # NOTE: model deployments in config.yaml are still required
  default_model_passthrough: true

  rules: []

  # MITM proxy settings (enable with --mitm flag)
  mitm:
    enabled: false
    port: 8081
    # PostgreSQL database for MITM traces
    database_url: "postgresql://ccproxy:test@localhost:5432/ccproxy_mitm"
    capture_bodies: true
    max_body_size: 0  # 0 = unlimited
    debug: false

litellm:
  host: 127.0.0.1
  port: 4000
  num_workers: 4
  debug: true
  detailed_debug: true

  # LiteLLM database features - disabled by default
  # Uncomment to enable model management via UI (requires litellm-db container)
  # environment:
  #   STORE_MODEL_IN_DB: "true"
  #   DATABASE_URL: "postgresql://ccproxy:test@localhost:5433/litellm"
